/* ==================================
   re-section.js - Monthly Retrospective Section
   ⚠️ 이 파일은 manager.py가 자동 생성합니다
   ================================== */

const isLocal = window.location.protocol === 'file:';

// Re section data - Generated by manager.py
const reData = [{"month": "2026.01", "url": "#", "title": "다짐과 회고 (Resolve & Retrospect)", "desc_kr": "<strong>[다짐 (Resolve)]</strong><br>1월 2일이 되고 커피를 마시며 나의 캘린더를 슥슥 내려보았다. 2030년까지 빽빽한 Future 캘린더..<br>격변은 1월부터 시작될 듯하다. MIT 6.0001 과정을 마무리하고 6.0002를 시작하게 된다. <br>하고 싶은 건 넘치는데 몸은 하나라, 무엇보다 우선순위를 냉철하게 정해야 할 시점이라는걸 다시금 느끼곤 한다.<br><br><strong>[회고 (Retrospect)]</strong><br>정말 질기고 길게 느껴졌던 2025년이 저물고 비로소 올 것 같지 않던 너무나 멀게 느껴지던 2026년이 밝았다. <br>작년 1월 1일은 쓰라린 기억으로 남아있지만, 올해의 첫날은 그 아픔을 되새기며 차분히 잠을 청했다.", "desc_en": ""}];

let activeFilter = 'all';

function generateReCards() {
    const grid = document.getElementById('reGrid');
    const lang = typeof currentLang !== 'undefined' ? currentLang : 'KR';
    
    const filteredData = activeFilter === 'all' 
        ? reData 
        : reData.filter(item => item.month.startsWith(activeFilter));

    if (isLocal) {
        grid.innerHTML = filteredData.map((item, idx) => `
            <div class="re-card" onclick="toggleReCard(${idx})" data-idx="${idx}">
                <div class="re-month">${item.month}</div>
                <div class="re-title">${item.title}</div>
                <div class="re-status">${lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand'}</div>
                <div class="re-content">
                    <div class="re-text">
                        ${lang === 'KR' ? (item.desc_kr || item.desc) : (item.desc_en || item.desc || item.desc_kr)}
                    </div>
                </div>
            </div>
        `).join('');
    } else {
        // For non-local, just show simple link cards if configured, but user wants content.
        // We will use the same card design for now to keep it consistent.
        grid.innerHTML = filteredData.map((item, idx) => `
            <div class="re-card" onclick="toggleReCard(${idx})" data-idx="${idx}">
                <div class="re-month">${item.month}</div>
                <div class="re-title">${item.title}</div>
                <div class="re-status">${lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand'}</div>
                <div class="re-content">
                    <div class="re-text">
                         ${lang === 'KR' ? (item.desc_kr || item.desc) : (item.desc_en || item.desc || item.desc_kr)}
                    </div>
                </div>
                ${item.url && item.url !== '#' ? `<a href="${item.url}" target="_blank" class="re-link">Read full review →</a>` : ''}
            </div>
        `).join('');
    }
    
    updateFilterOptions();
}

function updateFilterOptions() {
    const filter = document.getElementById('reYearFilter');
    if (!filter) return;
    
    const years = [...new Set(reData.map(item => item.month.split('.')[0]))].sort().reverse();
    const currentOptions = Array.from(filter.options).map(opt => opt.value);
    
    years.forEach(year => {
        if (!currentOptions.includes(year)) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year + ' Year';
            filter.appendChild(option);
        }
    });
}

function filterReCards() {
    const filter = document.getElementById('reYearFilter');
    activeFilter = filter.value;
    generateReCards();
}

function toggleReCard(idx) {
    const cards = document.querySelectorAll('.re-card');
    const lang = typeof currentLang !== 'undefined' ? currentLang : 'KR';
    
    cards.forEach((card, i) => {
        if (i === idx) {
            card.classList.toggle('active');
            const status = card.querySelector('.re-status');
            if (status) {
                status.textContent = card.classList.contains('active')
                    ? (lang === 'KR' ? '클릭하여 접기' : 'Click to collapse')
                    : (lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand');
            }
        } else {
            card.classList.remove('active');
            const status = card.querySelector('.re-status');
            if (status) {
                status.textContent = lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand';
            }
        }
    });
}
