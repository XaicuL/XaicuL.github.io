/* ==================================
   re-section.js - Monthly Retrospective Section
   ⚠️ 이 파일은 manager.py가 자동 생성합니다
   ================================== */

const isLocal = window.location.protocol === 'file:';

// Re section data - Generated by manager.py
const reData = [

];

let activeFilter = 'all';

function generateReCards() {
    const grid = document.getElementById('reGrid');
    const lang = typeof currentLang !== 'undefined' ? currentLang : 'KR';
    
    const filteredData = activeFilter === 'all' 
        ? reData 
        : reData.filter(item => item.month.startsWith(activeFilter));

    if (isLocal) {
        grid.innerHTML = filteredData.map((item, idx) => `
            <div class="re-card" onclick="toggleReCard(${idx})" data-idx="${idx}">
                <div class="re-month">${item.month}</div>
                <div class="re-title">${item.title}</div>
                <div class="re-status">${lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand'}</div>
                <div class="re-content">
                    <div class="re-section-title">${lang === 'KR' ? '다짐 Resolve' : 'Resolve'}</div>
                    <p class="re-text">${item.resolve}</p>
                    <div class="re-divider"></div>
                    <div class="re-section-title">${lang === 'KR' ? '회고 Retrospect' : 'Retrospect'}</div>
                    <p class="re-text">${item.retrospect}</p>
                </div>
            </div>
        `).join('');
    } else {
        grid.innerHTML = filteredData.map((item) => `
            <a href="${item.url}" class="re-card-link">
                <div class="re-card">
                    <div class="re-month">${item.month}</div>
                    <div class="re-title">${item.title}</div>
                    <div class="re-status">${lang === 'KR' ? '블로그로 이동 →' : 'Go to post →'}</div>
                </div>
            </a>
        `).join('');
    }
    
    updateFilterOptions();
}

function updateFilterOptions() {
    const filter = document.getElementById('reYearFilter');
    if (!filter) return;
    
    const years = [...new Set(reData.map(item => item.month.split('.')[0]))].sort().reverse();
    const currentOptions = Array.from(filter.options).map(opt => opt.value);
    
    years.forEach(year => {
        if (!currentOptions.includes(year)) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year + ' Year';
            filter.appendChild(option);
        }
    });
}

function filterReCards() {
    const filter = document.getElementById('reYearFilter');
    activeFilter = filter.value;
    generateReCards();
}

function toggleReCard(idx) {
    const cards = document.querySelectorAll('.re-card');
    const lang = typeof currentLang !== 'undefined' ? currentLang : 'KR';
    
    cards.forEach((card, i) => {
        if (i === idx) {
            card.classList.toggle('active');
            const status = card.querySelector('.re-status');
            if (status) {
                status.textContent = card.classList.contains('active')
                    ? (lang === 'KR' ? '클릭하여 접기' : 'Click to collapse')
                    : (lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand');
            }
        } else {
            card.classList.remove('active');
            const status = card.querySelector('.re-status');
            if (status) {
                status.textContent = lang === 'KR' ? '클릭하여 펼치기' : 'Click to expand';
            }
        }
    });
}
